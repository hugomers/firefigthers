import{aF as U,r as f,k as A,m as B,n as i,p as l,O as H,s,aG as T,q as r,av as c,N as y,Q as m,ax as Q,aH as q}from"./index.8e113646.js";import{Q as v}from"./QInput.a88593d9.js";import{Q as V,a as p}from"./QCard.4250549c.js";import{u as O,r as d,Q as D}from"./use-quasar.5a5b7ca7.js";import{Q as G}from"./QTable.f8d9b3ed.js";import{Q as S,C as P}from"./ClosePopup.6efd104c.js";import{Q as j}from"./QPage.def1fb97.js";import{api as g}from"./axios.7447b582.js";import{d as k}from"./dayjs.min.cbcf888d.js";import"./_commonjsHelpers.88e99c8f.js";const F={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},L={class:"row"},M={class:"col"},Y=s("br",null,null,-1),J={class:"col"},K=s("br",null,null,-1),W={class:"row"},X={class:"col"},Z=s("br",null,null,-1),ee={class:"col"},le=s("br",null,null,-1),te={class:"row"},ae={class:"col"},se=s("br",null,null,-1),oe={class:"col"},ie=s("br",null,null,-1),ne={class:"row"},de={class:"col"},re=s("br",null,null,-1),ce={class:"col"},ue=s("br",null,null,-1),me={class:"text-center"},ve={class:"text-center"},pe={class:"text-center"},ge={class:"text-centert"},_e={class:"text-center"},fe={class:"text-center"},be=s("span",{class:"q-ml-sm"},"Estas seguro de eliminar los registros ? Ya replicaste ? Segur@?",-1),Re={__name:"Devices",setup(we){const n=O();U();const h=f([]);f(null);const _=f({state:!1}),o=f([]),w=f(!1),b=f({columns:[{name:"id",label:"id",field:t=>t.id},{name:"name",label:"Dispositivo",field:t=>t.name},{name:"nick_name",label:"Nombre",field:t=>t.nick_name},{name:"id",label:"Numero de Serie",field:t=>t.serial_number},{name:"ip",label:"Direccion Ip",field:t=>t.ip},{name:"store",label:"Sucursal",field:t=>t.store.name}],filter:"",pagination:{rowsPerPage:[0]}}),x=async()=>{const t=await g.get("/zkt/Index");console.log(t.status),t.status!=200?console.log(t.data):(console.log(t.data),h.value=t.data,R(h.value))},R=t=>{t.forEach((e,a)=>{setTimeout(()=>{g.get(`/zkt/Ping/${e.ip_address}`).then(u=>{console.log(u.data),e._status=u.data.connect,e._att=u.data.register,e._time=u.data.date,e._curret=u.data.current}).catch(u=>{console.error(`Error pinging ${e.ip_address}:`,u)})},a*1e3)})},$=async t=>{n.loading.show({message:"Haciendo Pin :P"});const e=await g.get(`/zkt/Ping/${t}`);if(e.status!=200)console.log(e);else{let a=e.data?"Con Conexion":"Sin Conexion",u=e.data?"positive":"negative";n.notify({message:a,type:u,position:"center"}),n.loading.hide()}},I=async t=>{console.log(t),n.loading.show({message:"Editando"});const e=await g.post("/zkt/Edit",t);e.status!=200?console.log(e.data):(console.log(e.data),w.value=!1,n.notify({message:"Dispositivo Actualizado",type:"positive",position:"center"}),n.loading.hide(),x())},N=t=>{w.value=!0,o.value=t},C=async()=>{const t=o.value.id;console.log(t),n.loading.show({message:"Impotando Registros :P"});const e=await g.get(`/zkt/getRegisDevice/${t}`);e.status!=200?console.log(e):(console.log(e.data),n.notify({message:e.data.goals,type:"positive",position:"center"}),n.loading.hide())},z=async()=>{const t=o.value.id;console.log(t),n.loading.show({message:"Cambiando Horario :P"});const e=await g.get(`/zkt/changeDate/${t}`);e.status!=200?console.log(e):(console.log(e.data),o.value._time=e.data.date,o.value._curret=e.data.date,n.notify({message:"Cambio Realizado :)",type:"positive",position:"center"}),n.loading.hide())},E=async()=>{try{await C();const t=o.value.id;console.log(t),n.loading.show({message:"ELIMINANDO REGISTROS :P"});const e=await g.delete(`/zkt/deleteAttendance/${t}`);e.status!==200?console.log(e):(console.log(e.data),n.notify({message:"Registros Eliminados :)",type:"positive",position:"center"}))}catch(t){console.error(t)}finally{n.loading.hide(),_.value.state=!_.value.state}};return x(),(t,e)=>(A(),B(j,{padding:""},{default:i(()=>[l(G,{"hide-bottom":"",rows:h.value,columns:b.value.columns,"row-key":"name",grid:"",filter:b.value.filter,pagination:b.value.pagination},{"top-right":i(()=>[l(v,{borderless:"",dense:"",debounce:"300",modelValue:b.value.filter,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value.filter=a),placeholder:"Buscar"},{append:i(()=>[l(H,{name:"search"})]),_:1},8,["modelValue"])]),item:i(a=>[s("div",F,[l(V,{flat:"",bordered:"",style:T(`border: 3px solid ${a.row._status?"#03C988":"#B80000"};`),onClick:u=>N(a.row)},{default:i(()=>[l(p,{class:"text-center"},{default:i(()=>[s("div",L,[s("div",M,[r(" Sucursal "),Y,s("strong",null,c(a.row.store.name),1)]),s("div",J,[r(" Dispositivo "),K,s("strong",null,c(a.row.name),1)])])]),_:2},1024),l(d),l(p,{class:"text-center"},{default:i(()=>[s("div",W,[s("div",X,[r(" Direccion Ip "),Z,s("strong",null,c(a.row.ip_address),1)]),s("div",ee,[r(" Numero de Serie "),le,s("strong",null,c(a.row.serial_number),1)])])]),_:2},1024),l(d),l(p,{class:"text-center"},{default:i(()=>[s("div",te,[s("div",ae,[r(" Horario "),se,s("strong",null,c(a.row._curret),1)]),s("div",oe,[r(" Dispositivo "),ie,s("strong",null,c(a.row._time),1)])])]),_:2},1024),l(d),l(p,{class:"text-center"},{default:i(()=>[s("div",ne,[s("div",de,[r(" Registros "),re,s("strong",null,c(a.row._att),1)]),s("div",ce,[r(" Diferencia Tiempo "),ue,s("strong",null,c(y(k)(a.row._time).diff(y(k)(a.row._curret),"second",!0))+" s",1)])])]),_:2},1024),l(d)]),_:2},1032,["style","onClick"])])]),_:1},8,["rows","columns","filter","pagination"]),l(D,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=a=>w.value=a),persistent:""},{default:i(()=>[l(V,null,{default:i(()=>[l(p,{class:"items-center"},{default:i(()=>[l(v,{modelValue:o.value.store.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.store.name=a),type:"text",label:"Sucursal",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{modelValue:o.value.id,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.id=a),type:"text",label:"Id",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{modelValue:o.value.serial_number,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.serial_number=a),type:"text",label:"Numero de serie",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{modelValue:o.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.name=a),type:"text",label:"Dispositivo",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{modelValue:o.value.nick_name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.nick_name=a),type:"text",label:"Nombre",filled:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{modelValue:o.value.ip_address,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.ip_address=a),type:"text",label:"IP",filled:""},{append:i(()=>[l(m,{color:"primary",icon:"sensors",onClick:e[6]||(e[6]=a=>$(o.value.ip_address)),flat:""})]),_:1},8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),s("div",me,[r("Dispositivo: "),s("div",ve,c(o.value._time),1)]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),s("div",pe,[r(" Horario: "),s("div",ge,c(o.value._curret),1)]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),s("div",_e,[r("Diferencia: "),s("div",fe,c(y(k)(o.value._time).diff(y(k)(o.value._curret),"second",!0)),1)])]),_:1}),l(p,null,{default:i(()=>[l(m,{color:"primary",label:"Registros",onClick:C,outline:"",class:"full-width"}),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(m,{color:"primary",label:"Cambiar Horario",onClick:z,outline:"",class:"full-width"}),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(m,{color:"primary",label:"Eliminar Registros",onClick:e[8]||(e[8]=a=>_.value.state=!_.value.state),outline:"",class:"full-width",disabled:o.value._att<1e3},null,8,["disabled"])]),_:1}),l(S,{align:"center"},{default:i(()=>[Q(l(m,{flat:"",label:"Cancel",color:"negative"},null,512),[[P]]),l(m,{flat:"",label:"Editar",color:"positive",onClick:e[9]||(e[9]=a=>I(o.value))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(D,{modelValue:_.value.state,"onUpdate:modelValue":e[11]||(e[11]=a=>_.value.state=a),persistent:""},{default:i(()=>[l(V,null,{default:i(()=>[l(p,{class:"row items-center"},{default:i(()=>[l(q,{icon:"warning",color:"warning","text-color":"white"}),be]),_:1}),l(S,{align:"right"},{default:i(()=>[Q(l(m,{flat:"",label:"Cancelar",color:"positive"},null,512),[[P]]),l(m,{flat:"",label:"Aceptar",color:"negative",onClick:E})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Re as default};
