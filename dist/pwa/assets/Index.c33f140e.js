import{Q as Y}from"./QBadge.3acb4317.js";import{a as v,Q as O}from"./QCard.4250549c.js";import{u as Z,b as $,Q as N}from"./use-quasar.5a5b7ca7.js";import{r as p,d as D,k as w,m as Q,n as o,p as l,s as g,q as I,N as t,av as C,R as y,Q as _,P as B,O as U,ax as A,aB as R}from"./index.8e113646.js";import{Q as L}from"./QInput.a88593d9.js";import{Q as E}from"./QTable.f8d9b3ed.js";import{Q as h,C as q}from"./ClosePopup.6efd104c.js";import{Q as ee}from"./QSpinnerDots.eb551e5e.js";import{Q as le}from"./QTooltip.77612097.js";import{Q as te}from"./QPage.def1fb97.js";import{api as k}from"./axios.7447b582.js";const ae={class:"text-h4"},oe={class:"q-pa-md"},se={key:0},ne={class:"q-pa-md"},ue={key:0},re={class:"text-h6"},ie={class:"text-subtitle2"},de={class:"text-h6"},ce={class:"text-subtitle2"},ke={__name:"Index",setup(fe){const b=Z();let c=p({val:null,opts:[]}),P=p([]),u=p(!1),n=p({state:!1,cols:[],filter:""}),i=p({state:!1,row:null}),V=p(!1),m=p({state:!1,row:null}),S=D(()=>n.value.cols.filter(a=>a.ABONO.includes("-"))),T=D(()=>n.value.cols.filter(a=>a.ABONO==""||a.ABONO=="''")),F=D(()=>n.value.cols.filter(a=>a.ABONO=="No se creara Abono"));const M=async()=>{console.log("Cargando Sucursales");const a=await k.get("/abonos/getSuc").then(e=>e).catch(e=>e);a.request.status!=200?console.log(a.response.data):(console.log(a),P.value=a.data,c.value.opts=a.data)},G=async a=>{console.log(a.id);let e=a.id,s=await k.post("/abonos/getDev",{id:e});n.value.cols=s.data,n.value.state=!0,console.log(s.data)},z=(a,e)=>{i.value.state=!0,i.value.row=e},j=async()=>{u.value=!0,console.log("ignorando");let a=i.value.row.DEVOLUCION,e=c.value.val.id,s="No se creara Abono",f={devol:a,idsuc:e,mssg:s},r=await k.post("/Products/updev",f).then(d=>d).catch(d=>d);if(r.request.status!=200)console.log(r.request),b.notify({message:"status: "+r.request.status+" mssg: "+r.request.statusText,icon:"close",color:"negative"});else{console.log(r.data);let d=n.value.cols.findIndex(x=>x.DEVOLUCION==a);n.value.cols[d].ABONO=s,b.notify({message:"Devolucion "+a+" Ignorada",icon:"check",color:"positive"}),i.value.state=!1,u.value=!1}},H=async()=>{console.log("Generando Abono"),u.value=!0;let a={idsuc:c.value.val.id,devolucion:i.value.row.DEVOLUCION,observacion:i.value.row.REFERENCIA},e=await k.post("/Products/trapasAbo",a).then(f=>f).catch(f=>f);if(e.request.status!=200)console.log(e.request),b.notify({message:"status: "+e.request.status+" mssg: "+e.request.statusText,icon:"close",color:"negative"});else{console.log(e.data);let f=n.value.cols.findIndex(r=>r.DEVOLUCION==e.data.Movimientos.Devolucion);n.value.cols[f].ABONO=e.data.Movimientos.Abono,b.notify({message:"Abono "+e.data.Movimientos.Abono+" creado",icon:"check",color:"positive"}),i.value.state=!1,u.value=!1}};let J=()=>{console.log("Mostrando Ignorados"),V.value=!0},K=async(a,e)=>{console.log(e),m.value.state=!0,m.value.row=e},W=async()=>{console.log("se va a restaurar"),u.value=!0;let a=m.value.row.DEVOLUCION,e=c.value.val.id,s="''",f={devol:a,idsuc:e,mssg:s},r=await k.post("/Products/updev",f).then(d=>d).catch(d=>d);if(r.request.status!=200)console.log(r.request),b.notify({message:"status: "+r.request.status+" mssg: "+r.request.statusText,icon:"close",color:"negative"});else{console.log(r.data);let d=n.value.cols.findIndex(x=>x.DEVOLUCION==a);n.value.cols[d].ABONO=s,b.notify({message:"Devolucion "+a+" restaurada",icon:"check",color:"positive"}),m.value.state=!1,u.value=!1}};return M(),(a,e)=>(w(),Q(te,{padding:""},{default:o(()=>[l(O,{class:"my-card row"},{default:o(()=>[l(v,null,{default:o(()=>[g("div",ae,[I(" Devoluciones "),t(c).val?(w(),Q(Y,{key:0,align:"top"},{default:o(()=>[I(C(t(c).val.name),1)]),_:1})):y("",!0)])]),_:1}),l(v,null,{default:o(()=>[l($,{filled:"",modelValue:t(c).val,"onUpdate:modelValue":[e[0]||(e[0]=s=>t(c).val=s),G],"option-label":"name","input-debounce":"0",label:"Sucursal",options:t(c).opts,style:{width:"250px"},behavior:"menu"},null,8,["modelValue","options"])]),_:1}),t(n).state?(w(),Q(v,{key:0},{default:o(()=>[l(_,{color:"negative",icon:"archive",onClick:t(J)},null,8,["onClick"])]),_:1})):y("",!0)]),_:1}),g("div",oe,[t(n).state?(w(),B("div",se,[l(E,{title:"Devoluciones Pendientes",rows:t(T),"row-key":"name",filter:t(n).filter,onRowClick:z},{"top-right":o(()=>[l(L,{borderless:"",dense:"",debounce:"300",modelValue:t(n).filter,"onUpdate:modelValue":e[1]||(e[1]=s=>t(n).filter=s),placeholder:"Buscar"},{append:o(()=>[l(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])])):y("",!0)]),g("div",ne,[t(n).state?(w(),B("div",ue,[l(E,{title:"Devoluciones con Abono",rows:t(S),"row-key":"name",filter:t(n).filter},{"top-right":o(()=>[l(L,{borderless:"",dense:"",debounce:"300",modelValue:t(n).filter,"onUpdate:modelValue":e[2]||(e[2]=s=>t(n).filter=s),placeholder:"Buscar"},{append:o(()=>[l(U,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])])):y("",!0)]),l(N,{modelValue:t(V),"onUpdate:modelValue":e[3]||(e[3]=s=>R(V)?V.value=s:V=s),persistent:""},{default:o(()=>[l(O,null,{default:o(()=>[l(v,null,{default:o(()=>[l(h,{vertical:"",align:"left"},{default:o(()=>[A(l(_,{flat:"",icon:"arrow_back"},null,512),[[q]])]),_:1})]),_:1}),l(E,{rows:t(F),"row-key":"name",onRowClick:t(K)},null,8,["rows","onRowClick"])]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:t(m).state,"onUpdate:modelValue":e[4]||(e[4]=s=>t(m).state=s),persistent:""},{default:o(()=>[l(O,{class:"my-card"},{default:o(()=>[l(v,null,{default:o(()=>[g("div",re," DEVOLUCION : "+C(t(m).row.DEVOLUCION),1),g("div",ie," REF : "+C(t(m).row.REFERENCIA),1)]),_:1}),l(h,{align:"right"},{default:o(()=>[A(l(_,{flat:"",label:"Cerrar",color:"primary"},null,512),[[q]]),l(_,{flat:"",label:"Restaurar",color:"primary",onClick:t(W)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:t(i).state,"onUpdate:modelValue":e[5]||(e[5]=s=>t(i).state=s),persistent:""},{default:o(()=>[l(O,{class:"my-card"},{default:o(()=>[l(v,null,{default:o(()=>[g("div",de,"Devolucion: ("+C(t(i).row.DEVOLUCION)+")",1),g("div",ce,"Referencia: "+C(t(i).row.REFERENCIA),1)]),_:1}),l(v,null,{default:o(()=>[l(h,null,{default:o(()=>[l(_,{flat:"",label:"Ignorar",onClick:j}),l(_,{flat:"",label:"Generar Abono",onClick:H,disable:t(u)},null,8,["disable"])]),_:1})]),_:1}),l(h,null,{default:o(()=>[A(l(_,{flat:"",label:"Cerrar"},null,512),[[q]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:t(u),"onUpdate:modelValue":e[6]||(e[6]=s=>R(u)?u.value=s:u=s),persistent:t(u)},{default:o(()=>[t(u)?(w(),Q(O,{key:0},{default:o(()=>[l(v,{class:"row items-center"},{default:o(()=>[l(ee,{color:"secondary",size:"2em"}),l(le,{offset:[0,8]},{default:o(()=>[I("creando..")]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue","persistent"])]),_:1}))}};export{ke as default};
