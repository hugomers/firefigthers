import{c as M,r as x,A as $,I as K,J as z,v as J,f as X,t as G,g as H,K as W,L as T,y as Y,M as Z,d as P,k as S,m as B,n as i,s as f,p as o,N as t,Q as L,O as A,q as D,P as O,R as Q}from"./index.991b573f.js";import{Q as u}from"./QInput.04f97084.js";import{Q as ee}from"./QTable.4f92d824.js";import{a as le,u as ae,Q as te,b as U}from"./use-quasar.2f956a97.js";import{Q as R,a as g}from"./QCard.7e9739bf.js";import{Q as oe}from"./QPage.abfca986.js";import{api as h}from"./axios.966b62b8.js";var j=M({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(p,{slots:C,emit:V}){const r=H(),e=x(null);let b=0;const d=[];function E(l){const a=typeof l=="boolean"?l:p.noErrorFocus!==!0,m=++b,w=(s,c)=>{V("validation"+(s===!0?"Success":"Error"),c)},_=s=>{const c=s.validate();return typeof c.then=="function"?c.then(v=>({valid:v,comp:s}),v=>({valid:!1,comp:s,err:v})):Promise.resolve({valid:c,comp:s})};return(p.greedy===!0?Promise.all(d.map(_)).then(s=>s.filter(c=>c.valid!==!0)):d.reduce((s,c)=>s.then(()=>_(c).then(v=>{if(v.valid===!1)return Promise.reject(v)})),Promise.resolve()).catch(s=>[s])).then(s=>{if(s===void 0||s.length===0)return m===b&&w(!0),!0;if(m===b){const{comp:c,err:v}=s[0];if(v!==void 0&&console.error(v),w(!1,c),a===!0){const F=s.find(({comp:N})=>typeof N.focus=="function"&&W(N.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function q(){b++,d.forEach(l=>{typeof l.resetValidation=="function"&&l.resetValidation()})}function k(l){l!==void 0&&T(l);const a=b+1;E().then(m=>{a===b&&m===!0&&(p.onSubmit!==void 0?V("submit",l):l!==void 0&&l.target!==void 0&&typeof l.target.submit=="function"&&l.target.submit())})}function I(l){l!==void 0&&T(l),V("reset"),Y(()=>{q(),p.autofocus===!0&&p.noResetFocus!==!0&&y()})}function y(){le(()=>{if(e.value===null)return;const l=e.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||e.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||e.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(e.value.querySelectorAll("[tabindex]"),a=>a.tabIndex>-1);l!=null&&l.focus({preventScroll:!0})})}$(Z,{bindComponent(l){d.push(l)},unbindComponent(l){const a=d.indexOf(l);a>-1&&d.splice(a,1)}});let n=!1;return K(()=>{n=!0}),z(()=>{n===!0&&p.autofocus===!0&&y()}),J(()=>{p.autofocus===!0&&y()}),Object.assign(r.proxy,{validate:E,resetValidation:q,submit:k,reset:I,focus:y,getValidationComponents:()=>d}),()=>X("form",{class:"q-form",ref:e,onSubmit:k,onReset:I},G(C.default))}});const ne={class:"absolute-top row justify-end"},se={class:"text-h4"},ue={class:"row justify-between"},de={key:0},ie={class:"text-h4"},re=f("div",{class:"text-h5 text-center subrayado"},"Datos cliente",-1),me={class:"row q-my-sm"},ce={class:"row q-my-sm"},ve=f("div",{class:"text-h5 text-center subrayado"},"Datos Sucursal",-1),fe={key:0},ke={__name:"Index",setup(p){const C=ae();let V=x({state:!1}),r=x({state:!1,val:"",table:{cols:[{name:"Fs_id",label:"Codigo",field:"CODCLI"},{name:"Nombre",label:"Nombre",field:"NOFCLI"},{name:"Email",label:"Correo",field:"EMACLI"},{name:"Telefono",label:"Telefono",field:"TELCLI"},{name:"Tarifa",label:"Precio",field:"TARCLI"}],rows:[],noresults:"><"}});x([]);let e=x({branch:{val:null,opts:[]},name:"",ticket:null,address:{street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},phone:"",email:null,priceList:{val:null,opts:[{id:2,label:"Mayoreo"},{id:3,label:"Docena"},{id:4,label:"Caja"},{id:5,label:"Especial"},{id:6,label:"Centro"}]},agent:{db:[],val:null,opts:[]},notes:null,state:!1}),b=P(()=>e.value.branch.val&&e.value.priceList.val&&e.value.name&&e.value.name.length>4&&(e.value.phone&&e.value.phone.length==12||e.value.email)&&e.value.agent&&e.value.ticket&&e.value.address.street&&e.value.address.state&&e.value.address.mun),d=P(()=>({branch:e.value.branch.val,name:e.value.name.toUpperCase(),ticket:e.value.ticket,address:e.value.address,phone:e.value.phone?e.value.phone.split("-").join(""):null,email:e.value.email?e.value.email:null,priceList:e.value.priceList.val,agent:e.value.agent.val,notes:e.value.notes}));(async()=>{const n=await h.get("/admincli");console.log(n.data),e.value.branch.opts=n.data.branches,e.value.agent.db=n.data.agents})();const q=async()=>{e.value.state=!0;let n=[];n=(await h.get("/admincli/getclient")).data;let a=n.findIndex(m=>m.TELCLI==d.value.phone||m.EMACLI==d.value.email);if(console.log(a),a<0){let m=await h.post("/admincli",d.value);k(),console.log(d.value),e.value.state=!1,C.notify({message:"Formulario Enviado....",icon:"check_circle",color:"positive"}),console.log(m)}else{e.value.state=!1,console.log(n[a]);let m=n[a].CODCLI+" - "+n[a].NOFCLI;C.notify({message:"El cliente existe ID "+m,icon:"close",color:"negative"})}},k=()=>{e.value.ticket=null,e.value.branch.val=null,e.value.priceList.val=null,e.value.name="",e.value.agent.val=null,e.value.address={street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},e.value.phone="",e.value.email=null,e.value.notes=null},I=n=>{e.value.agent.opts=e.value.agent.db.filter(l=>l._store==n.id)};let y=async()=>{let n=r.value.val;const l=await h.get(`/admincli/getclient?q=${n}`);r.value.table.rows=l.data,r.value.state=!0,console.log(l)};return(n,l)=>(S(),B(oe,{padding:"",class:"flex flex-center"},{default:i(()=>[f("div",ne,[o(L,{flat:"",round:"",icon:"search",color:"teal",onClick:l[0]||(l[0]=a=>t(V).state=!0),title:"Restaurar",size:"2em"})]),o(te,{modelValue:t(V).state,"onUpdate:modelValue":l[2]||(l[2]=a=>t(V).state=a)},{default:i(()=>[o(R,{class:"my-card"},{default:i(()=>[o(g,null,{default:i(()=>[f("div",se,[o(A,{name:"search",class:"q-mr-xs"}),D(" Buscador de Clientes ")]),o(g,null,{default:i(()=>[o(j,{onSubmit:t(y)},{default:i(()=>[f("div",ue,[o(u,{modelValue:t(r).val,"onUpdate:modelValue":l[1]||(l[1]=a=>t(r).val=a),type:"text",label:"Buscar"},null,8,["modelValue"]),o(L,{icon:"search",type:"submit",color:"primary"})]),t(r).state?(S(),O("div",de,[o(ee,{rows:t(r).table.rows,columns:t(r).table.cols,"row-key":"name","no-data-label":t(r).table.noresults},null,8,["rows","columns","no-data-label"])])):Q("",!0)]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(R,{bordered:"",flat:"",class:"my-card"},{default:i(()=>[o(g,{class:"my-card bg-secondary text-white"},{default:i(()=>[f("div",ie,[o(A,{name:"person_add",class:"q-mr-xs"}),D(" Solicitud para alta de cliente ")])]),_:1}),o(g,null,{default:i(()=>[o(j,{onSubmit:q,class:"q-gutter-md text-grey-10"},{default:i(()=>[f("div",null,[o(g,{class:""},{default:i(()=>[re]),_:1}),o(u,{rounded:"",outlined:"",modelValue:t(e).name,"onUpdate:modelValue":l[3]||(l[3]=a=>t(e).name=a),label:"Nombre del Cliente",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).address.street,"onUpdate:modelValue":l[4]||(l[4]=a=>t(e).address.street=a),label:"Calle",class:"q-my-sm"},null,8,["modelValue"]),f("div",me,[o(u,{rounded:"",outlined:"",modelValue:t(e).address.numint,"onUpdate:modelValue":l[5]||(l[5]=a=>t(e).address.numint=a),label:"Num INT",class:"col"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).address.numext,"onUpdate:modelValue":l[6]||(l[6]=a=>t(e).address.numext=a),label:"Num EXT",class:"col"},null,8,["modelValue"])]),f("div",ce,[o(u,{rounded:"",outlined:"",modelValue:t(e).address.cp,"onUpdate:modelValue":l[7]||(l[7]=a=>t(e).address.cp=a),label:"Codigo Postal",mask:"#####",class:"col"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).address.state,"onUpdate:modelValue":l[8]||(l[8]=a=>t(e).address.state=a),label:"Estado",class:"col"},null,8,["modelValue"])]),o(u,{rounded:"",outlined:"",modelValue:t(e).address.colinia,"onUpdate:modelValue":l[9]||(l[9]=a=>t(e).address.colinia=a),label:"Colonia",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).address.mun,"onUpdate:modelValue":l[10]||(l[10]=a=>t(e).address.mun=a),label:"Municipio",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).phone,"onUpdate:modelValue":l[11]||(l[11]=a=>t(e).phone=a),label:"Telefono",mask:"##-####-####",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:t(e).email,"onUpdate:modelValue":l[12]||(l[12]=a=>t(e).email=a),label:"Correo Electronico",class:"q-my-sm"},null,8,["modelValue"]),o(g,{class:""},{default:i(()=>[ve]),_:1}),o(u,{rounded:"",outlined:"",modelValue:t(e).ticket,"onUpdate:modelValue":l[13]||(l[13]=a=>t(e).ticket=a),label:"Ticket",mask:"#-######",class:"q-my-sm"},null,8,["modelValue"]),o(U,{rounded:"",outlined:"","option-label":"name",modelValue:t(e).branch.val,"onUpdate:modelValue":[l[14]||(l[14]=a=>t(e).branch.val=a),I],options:t(e).branch.opts,onInput:l[15]||(l[15]=a=>n.getStaff(t(e).branch.val.id)),label:"Selecciona Sucursal",class:"q-my-sm"},null,8,["modelValue","options"]),t(e).branch.val?(S(),B(U,{key:0,rounded:"",outlined:"","option-label":"complete_name",modelValue:t(e).agent.val,"onUpdate:modelValue":l[16]||(l[16]=a=>t(e).agent.val=a),options:t(e).agent.opts,label:"Quien atendio",class:"q-my-sm"},null,8,["modelValue","options"])):Q("",!0),o(U,{rounded:"",outlined:"",modelValue:t(e).priceList.val,"onUpdate:modelValue":l[17]||(l[17]=a=>t(e).priceList.val=a),options:t(e).priceList.opts,label:"Precio Otorgado",class:"q-my-sm"},null,8,["modelValue","options"]),o(u,{rounded:"",outlined:"",modelValue:t(e).notes,"onUpdate:modelValue":l[18]||(l[18]=a=>t(e).notes=a),label:"Notas",class:"q-my-sm"},null,8,["modelValue"])]),t(b)?(S(),O("div",fe,[o(L,{label:"Enviar",type:"submit",color:"primary",loading:t(e).state},null,8,["loading"])])):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ke as default};
